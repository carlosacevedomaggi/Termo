module.exports=[32245,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"BailoutToCSR",{enumerable:!0,get:function(){return e}});let d=a.r(41997);function e(a){let{reason:b,children:c}=a;throw Object.defineProperty(new d.BailoutToCSRError(b),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0})}},7773,(a,b,c)=>{"use strict";function d(a){return a.split("/").map(a=>encodeURIComponent(a)).join("/")}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"encodeURIPath",{enumerable:!0,get:function(){return d}})},97458,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"PreloadChunks",{enumerable:!0,get:function(){return h}});let d=a.r(87924),e=a.r(35112),f=a.r(56704),g=a.r(7773);function h(a){let{moduleIds:b}=a,c=f.workAsyncStorage.getStore();if(void 0===c)return null;let h=[];if(c.reactLoadableManifest&&b){let a=c.reactLoadableManifest;for(let c of b){if(!a[c])continue;let b=a[c].files;h.push(...b)}}return 0===h.length?null:(0,d.jsx)(d.Fragment,{children:h.map(a=>{let b=c.assetPrefix+"/_next/"+(0,g.encodeURIPath)(a);return a.endsWith(".css")?(0,d.jsx)("link",{precedence:"dynamic",href:b,rel:"stylesheet",as:"style"},a):((0,e.preload)(b,{as:"script",fetchPriority:"low"}),null)})})}},69853,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"default",{enumerable:!0,get:function(){return j}});let d=a.r(87924),e=a.r(72131),f=a.r(32245),g=a.r(97458);function h(a){return{default:a&&"default"in a?a.default:a}}let i={loader:()=>Promise.resolve(h(()=>null)),loading:null,ssr:!0},j=function(a){let b={...i,...a},c=(0,e.lazy)(()=>b.loader().then(h)),j=b.loading;function k(a){let h=j?(0,d.jsx)(j,{isLoading:!0,pastDelay:!0,error:null}):null,i=!b.ssr||!!b.loading,k=i?e.Suspense:e.Fragment,l=b.ssr?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(g.PreloadChunks,{moduleIds:b.modules}),(0,d.jsx)(c,{...a})]}):(0,d.jsx)(f.BailoutToCSR,{reason:"next/dynamic",children:(0,d.jsx)(c,{...a})});return(0,d.jsx)(k,{...i?{fallback:h}:{},children:l})}return k.displayName="LoadableComponent",k}},19721,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"default",{enumerable:!0,get:function(){return e}});let d=a.r(33354)._(a.r(69853));function e(a,b){var c;let e={};"function"==typeof a&&(e.loader=a);let f={...e,...b};return(0,d.default)({...f,modules:null==(c=f.loadableGenerated)?void 0:c.modules})}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},94936,(a,b,c)=>{var d=0/0,e=/^\s+|\s+$/g,f=/^[-+]0x[0-9a-f]+$/i,g=/^0b[01]+$/i,h=/^0o[0-7]+$/i,i=parseInt,j=a.g&&a.g.Object===Object&&a.g,k="object"==typeof self&&self&&self.Object===Object&&self,l=j||k||Function("return this")(),m=Object.prototype.toString,n=Math.max,o=Math.min,p=function(){return l.Date.now()};function q(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}function r(a){if("number"==typeof a)return a;if("symbol"==typeof(b=a)||b&&"object"==typeof b&&"[object Symbol]"==m.call(b))return d;if(q(a)){var b,c="function"==typeof a.valueOf?a.valueOf():a;a=q(c)?c+"":c}if("string"!=typeof a)return 0===a?a:+a;a=a.replace(e,"");var j=g.test(a);return j||h.test(a)?i(a.slice(2),j?2:8):f.test(a)?d:+a}b.exports=function(a,b,c){var d,e,f,g,h,i,j=0,k=!1,l=!1,m=!0;if("function"!=typeof a)throw TypeError("Expected a function");function s(b){var c=d,f=e;return d=e=void 0,j=b,g=a.apply(f,c)}function t(a){var c=a-i,d=a-j;return void 0===i||c>=b||c<0||l&&d>=f}function u(){var a,c,d,e=p();if(t(e))return v(e);h=setTimeout(u,(a=e-i,c=e-j,d=b-a,l?o(d,f-c):d))}function v(a){return(h=void 0,m&&d)?s(a):(d=e=void 0,g)}function w(){var a,c=p(),f=t(c);if(d=arguments,e=this,i=c,f){if(void 0===h)return j=a=i,h=setTimeout(u,b),k?s(a):g;if(l)return h=setTimeout(u,b),s(i)}return void 0===h&&(h=setTimeout(u,b)),g}return b=r(b)||0,q(c)&&(k=!!c.leading,f=(l="maxWait"in c)?n(r(c.maxWait)||0,b):f,m="trailing"in c?!!c.trailing:m),w.cancel=function(){void 0!==h&&clearTimeout(h),j=0,d=i=e=h=void 0},w.flush=function(){return void 0===h?g:v(p())},w}},94894,a=>{"use strict";a.s(["default",()=>t],94894);var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(60115);let f={zelleName:"INDUSTRIAS TERMOTRONIC",zelleEmail:"pagos@termotronic.com",pmFullName:"INDUSTRIAS TERMOTRONIC",pmPhone:"0412-TERMOTRO",pmNationalId:"J-301781899",pmBankName:"Banesco",pmBankCode:"0134",bankFullName:"INDUSTRIAS TERMOTRONIC",bankNationalId:"J-301781899",bankName:"Banesco",bankAccountType:"Cuenta Verde Efectivo US$",bankAccountNumber:"01341740720021814454"},g=[{id:"paypal",label:"PayPal (USD)",description:"Pay using your PayPal account",currency:"USD",merchantInfo:[{label:"PayPal Business",value:"paypal@termotronic.com"}],fields:[{id:"paypalEmail",label:"Correo PayPal",type:"email",required:!0},{id:"paypalTxn",label:"ID de transacción (opcional)",type:"text",placeholder:"p. ej. 9AB12345CD6789012"}]},{id:"card",label:"Credit/Debit Card",description:"Pay securely with your card",currency:"USD",merchantInfo:[{label:"Proveedor",value:"PayPal Checkout"},{label:"Tarjetas",value:"Visa, Mastercard, American Express"}],fields:[{id:"cardHolder",label:"Nombre en la tarjeta",type:"text",required:!0},{id:"cardEmail",label:"Correo del titular",type:"email",required:!0}]},{id:"zelle",label:"Zelle (USD)",description:"Transfer via Zelle in USD",currency:"USD",merchantInfo:[{label:"Recipient name",value:f.zelleName},{label:"Zelle email",value:f.zelleEmail}],fields:[{id:"senderName",label:"Nombre del remitente",type:"text",required:!0},{id:"senderEmail",label:"Correo del remitente",type:"email",required:!0},{id:"confirmation",label:"Número de confirmación (opcional)",type:"text",placeholder:"p. ej. ABC123"}]},{id:"pagomovil",label:"Pago Móvil (VES)",description:"Pago móvil interbancario en bolívares",currency:"VES",merchantInfo:[{label:"Banco",value:`${f.pmBankName} (${f.pmBankCode})`},{label:"Titular",value:f.pmFullName},{label:"Teléfono",value:f.pmPhone},{label:"Cédula/RIF",value:f.pmNationalId}],fields:[{id:"payerPhone",label:"Tu teléfono (Pago Móvil)",type:"text",required:!0,placeholder:"04xx-xxxxxxx"},{id:"payerId",label:"Tu cédula/RIF",type:"text",required:!0,placeholder:"V-xxxxxxx"},{id:"payerBank",label:"Tu banco",type:"select",required:!0,options:[{label:"Banco de Venezuela (0102)",value:"0102"},{label:"Banesco (0134)",value:"0134"},{label:"Mercantil (0105)",value:"0105"},{label:"Provincial (0108)",value:"0108"},{label:"BNC (0191)",value:"0191"}]},{id:"reference",label:"Referencia de pago",type:"text",required:!0}]},{id:"bank",label:"Depósito Banesco Verde (USD)",description:"Depósito directo en cuenta Banesco Verde en dólares",currency:"USD",merchantInfo:[{label:"Banco",value:f.bankName},{label:"Tipo de cuenta",value:f.bankAccountType},{label:"Nº de cuenta",value:f.bankAccountNumber},{label:"Titular",value:f.bankFullName},{label:"RIF",value:f.bankNationalId},{label:"Instrucción",value:"Deposita en taquilla y envía el comprobante a tienda@termotronic.com"}],fields:[{id:"depositDate",label:"Fecha del depósito",type:"text",required:!0,placeholder:"DD/MM/AAAA"},{id:"reference",label:"Número de comprobante",type:"text",required:!0}]}];var h=a.i(66614),i=a.i(19721),j=a.i(94936);function k(a,b,c,d){let e=a=>a*Math.PI/180,f=e(a),g=e(c),h=Math.sin(e(c-a)/2)**2+Math.cos(f)*Math.cos(g)*Math.sin(e(d-b)/2)**2;return 2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h))*6371e3}function l(a,b,c){return[...a].sort((a,d)=>k(b,c,a.lat,a.lng)-k(b,c,d.lat,d.lng))}let m=(0,i.default)(async()=>{},{loadableGenerated:{modules:[55547]},ssr:!1});function n({partners:a,value:d,onChange:e,errors:f,onErrorsChange:g,onComplete:h}){let[i,k]=(0,c.useState)(""),[n,r]=(0,c.useState)([]),[s,t]=(0,c.useState)(!1);(0,c.useEffect)(()=>{k(d.customerLocation?.label??"")},[d.customerLocation]);let u=(0,c.useMemo)(()=>d.customerLocation?l(a,d.customerLocation.lat,d.customerLocation.lng).slice(0,5):a.slice(0,5),[a,d.customerLocation]);(0,c.useMemo)(()=>a.find(a=>a.id===d.selectedPartnerId)??null,[a,d.selectedPartnerId]);let v=(0,c.useMemo)(()=>(0,j.default)(async a=>{if(!a.trim())return void r([]);t(!0);try{let b=await fetch("/api/geocode",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:a})});if(!b.ok)return void console.error("Geocode failed",await b.text());let c=await b.json();r(c.results)}catch(a){console.error("Geocode error",a)}finally{t(!1)}},400),[]);(0,c.useEffect)(()=>{i&&i!==d.customerLocation?.label?v(i):r([])},[i,d.customerLocation,v]);let w=b=>{e({...d,customerLocation:b,selectedPartnerId:l(a,b.lat,b.lng)[0]?.id??null}),g({...f,customerLocation:""})};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,b.jsx)(o,{label:"Nombre completo",value:d.name,onChange:a=>e({...d,name:a}),error:f.name,required:!0}),(0,b.jsx)(o,{label:"Correo electrónico",type:"email",value:d.email,onChange:a=>e({...d,email:a}),error:f.email,required:!0}),(0,b.jsx)(o,{label:"Teléfono (opcional)",value:d.phone,onChange:a=>e({...d,phone:a})})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("label",{className:"text-sm font-semibold uppercase tracking-[0.25em] text-slate-500",children:"Modalidad"}),(0,b.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,b.jsx)(p,{label:"Retiro en distribuidor",description:"Elige el aliado más conveniente.",selected:"pickup"===d.fulfillmentMode,onClick:()=>e({...d,fulfillmentMode:"pickup"})}),(0,b.jsx)(p,{label:"Entrega a domicilio",description:"Coordinamos la entrega con el aliado más cercano.",selected:"delivery"===d.fulfillmentMode,onClick:()=>e({...d,fulfillmentMode:"delivery"})})]})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("label",{className:"text-sm font-semibold uppercase tracking-[0.25em] text-slate-500",children:"pickup"===d.fulfillmentMode?"Selecciona tu punto aliado":"Dirección de entrega"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("input",{value:i,onChange:a=>k(a.target.value),placeholder:"pickup"===d.fulfillmentMode?"Busca tu dirección o tu aliado":"Escribe tu dirección",className:"w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-200"}),s&&(0,b.jsx)("p",{className:"text-xs text-slate-500",children:"Buscando…"}),n.length>0&&(0,b.jsx)("div",{className:"max-h-48 overflow-y-auto rounded-xl border border-slate-200 bg-white shadow-sm",children:n.map(a=>(0,b.jsxs)("button",{type:"button",onClick:()=>{w({lat:a.lat,lng:a.lng,label:a.label}),r([]),k(a.label)},className:"flex w-full flex-col items-start px-3 py-2 text-left text-sm hover:bg-slate-100",children:[(0,b.jsx)("span",{className:"font-medium text-slate-900",children:a.name}),(0,b.jsx)("span",{className:"text-xs text-slate-600",children:a.locality?`${a.locality} • ${a.label}`:a.label})]},a.id))}),f.customerLocation&&(0,b.jsx)("p",{className:"text-xs text-red-600",children:f.customerLocation})]})]}),(0,b.jsx)("div",{className:"h-80 overflow-hidden rounded-2xl border border-slate-200",children:(0,b.jsx)(m,{customerLocation:d.customerLocation,partners:a,fulfillmentMode:d.fulfillmentMode,selectedPartnerId:d.selectedPartnerId,onCustomerLocationChange:w,onSelectPartner:a=>e({...d,selectedPartnerId:a})})}),"pickup"===d.fulfillmentMode&&(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-slate-700",children:"Aliados sugeridos"}),(0,b.jsx)(q,{options:u,selectedId:d.selectedPartnerId,onSelect:a=>e({...d,selectedPartnerId:a})}),f.selectedPartnerId&&(0,b.jsx)("p",{className:"text-xs text-red-600",children:f.selectedPartnerId})]}),(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsx)("button",{type:"button",className:"btn btn-primary",onClick:()=>{let a={};d.name.trim()||(a.name="Requerido"),d.email.trim()||(a.email="Requerido"),d.customerLocation||(a.customerLocation="Selecciona una ubicación"),"pickup"!==d.fulfillmentMode||d.selectedPartnerId||(a.selectedPartnerId="Selecciona un aliado"),g(a),0===Object.keys(a).length&&h()},children:"Continuar"})})]})}function o({label:a,value:c,onChange:d,error:e,required:f,type:g="text"}){return(0,b.jsxs)("label",{className:"block text-sm font-medium text-slate-700",children:[a,(0,b.jsx)("input",{type:g,value:c,required:f,onChange:a=>d(a.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-200"}),e&&(0,b.jsx)("span",{className:"mt-1 block text-xs text-red-600",children:e})]})}function p({label:a,description:c,selected:d,onClick:e}){return(0,b.jsxs)("button",{type:"button",onClick:e,className:`rounded-2xl border px-4 py-3 text-left transition ${d?"border-slate-900 bg-slate-900/5":"border-slate-200 hover:border-slate-300"}`,children:[(0,b.jsx)("div",{className:"font-semibold text-slate-900",children:a}),(0,b.jsx)("p",{className:"mt-1 text-xs text-slate-600",children:c})]})}function q({options:a,selectedId:c,onSelect:d}){return(0,b.jsx)("div",{className:"space-y-2",children:a.map(a=>(0,b.jsxs)("button",{type:"button",onClick:()=>d(a.id),className:`flex w-full items-start justify-between rounded-xl border px-3 py-2 text-left text-sm transition ${c===a.id?"border-slate-900 bg-slate-900/5":"border-slate-200 hover:border-slate-300"}`,children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-semibold text-slate-900",children:a.name}),(0,b.jsx)("div",{className:"text-xs text-slate-600",children:a.address}),(0,b.jsx)("div",{className:"text-[11px] uppercase tracking-wide text-slate-400",children:a.cityState})]}),(0,b.jsx)("div",{className:"text-xs text-slate-500",children:c===a.id?"Seleccionado":"Elegir"})]},a.id))})}let r=Object.entries(a.i(56264).default).map(([a,b])=>({id:a,type:b.type,name:b.name,address:b.address,cityState:b.cityState,lat:b.lat,lng:b.lng,source:b.source}));function s(a){return a?r.find(b=>b.id===a)??null:null}function t(){let a=(0,d.useRouter)(),{items:f,clear:i}=(0,e.useCartStore)(),[j,k]=(0,c.useState)(!1);(0,c.useEffect)(()=>{k(!0)},[]);let l=(0,c.useMemo)(()=>r.filter(a=>"distributor"===a.type),[]),m=(0,c.useMemo)(()=>f.reduce((a,b)=>a+b.price*(b.quantity??1),0),[f]),o=(0,c.useMemo)(()=>f.map(a=>({key:a.id,name:a.name,quantity:a.quantity??1,total:a.price*(a.quantity??1)})),[f]),[p,q]=(0,c.useState)(1),[t,C]=(0,c.useState)({name:"",email:"",phone:"",fulfillmentMode:"pickup",customerLocation:null,selectedPartnerId:null}),[D,E]=(0,c.useState)({}),[F,G]=(0,c.useState)(null);async function H(a,b,c){try{let d=await fetch("/api/directions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({start:{lat:a,lng:b},end:{lat:c.lat,lng:c.lng}})});if(!d.ok){let e=await d.text();return console.warn("Directions failed",e),I(a,b,c)}let e=await d.json(),f=Math.round((e.duration??0)/60),g=Math.min(f,45);return{partnerId:c.id,partnerName:c.name,partnerAddress:c.address,partnerCityState:c.cityState,minutes:f,minutesCapped:g,fee:.5*g,distanceMeters:e.distance??null,source:"ors"}}catch(d){return console.warn("Directions error",d),I(a,b,c)}}function I(a,b,c){let d=B(a,b,c.lat,c.lng),e=Math.round(d/1e3/40*60),f=Math.max(10,Math.min(e,45));return{partnerId:c.id,partnerName:c.name,partnerAddress:c.address,partnerCityState:c.cityState,minutes:e,minutesCapped:f,fee:.5*f,distanceMeters:d,source:"fallback"}}(0,c.useEffect)(()=>{if(!t.customerLocation||"delivery"!==t.fulfillmentMode||!t.selectedPartnerId)return void G(null);let a=s(t.selectedPartnerId);if(!a)return void G(null);H(t.customerLocation.lat,t.customerLocation.lng,{id:a.id,name:a.name,address:a.address,cityState:a.cityState,lat:a.lat,lng:a.lng}).then(a=>{a&&G(a)})},[t.customerLocation,t.fulfillmentMode,t.selectedPartnerId]);let[J,K]=(0,c.useState)(g[0]?.id??"paypal"),L=(0,c.useMemo)(()=>g.find(a=>a.id===J),[J]),[M,N]=(0,c.useState)({}),[O,P]=(0,c.useState)({}),[Q,R]=(0,c.useState)("email"),[S,T]=(0,c.useState)(null),[U,V]=(0,c.useState)(null),[W,X]=(0,c.useState)("idle"),[Y,Z]=(0,c.useState)(null),{isConfigured:$}=(0,h.usePayPalConfig)(),_="delivery"===t.fulfillmentMode&&F?F.fee:0,aa=m+_,ab=t.phone?`***-${t.phone.slice(-3)}`:"No proporcionado",ac="pickup"===t.fulfillmentMode&&t.selectedPartnerId||"delivery"===t.fulfillmentMode&&F,ad="paypal"===J||"card"===J;return f.length||Y||4===p?j?(0,b.jsxs)("div",{className:"container-edge py-12",children:[(0,b.jsx)("h1",{className:"text-3xl font-semibold",children:"Checkout"}),(0,b.jsx)(u,{currentStep:p}),(0,b.jsxs)("div",{className:"mt-8 grid gap-8 lg:grid-cols-[minmax(0,1fr)_minmax(320px,0.7fr)]",children:[(0,b.jsxs)("div",{className:"space-y-6",children:[1===p&&(0,b.jsx)(v,{title:"1. Información y ubicación",children:(0,b.jsx)(n,{partners:l,value:t,onChange:a=>C(a),errors:D,onErrorsChange:E,onComplete:()=>q(2)})}),2===p&&(0,b.jsxs)(v,{title:"2. Entrega y método de pago",children:[(0,b.jsxs)("section",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold uppercase tracking-[0.25em] text-slate-500",children:"Modalidad"}),(0,b.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,b.jsx)(x,{label:"Retiro en distribuidor",description:"Elige el punto aliado más conveniente para retirar tu pedido.",selected:"pickup"===t.fulfillmentMode,onClick:()=>{C(a=>({...a,fulfillmentMode:"pickup"})),G(null)}}),(0,b.jsx)(x,{label:"Entrega a domicilio",description:"Coordinamos con el aliado más cercano y calculamos el cargo de envío.",selected:"delivery"===t.fulfillmentMode,onClick:async()=>{let a=t.selectedPartnerId?s(t.selectedPartnerId):null;C(a=>({...a,fulfillmentMode:"delivery"})),a&&t.customerLocation&&H(t.customerLocation.lat,t.customerLocation.lng,{id:a.id,name:a.name,address:a.address,cityState:a.cityState,lat:a.lat,lng:a.lng}).then(a=>{a&&G(a)})}})]})]}),(0,b.jsxs)("section",{className:"mt-6 space-y-3",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold uppercase tracking-[0.25em] text-slate-500",children:"pickup"===t.fulfillmentMode?"Aliado seleccionado":"Entrega coordinada"}),(0,b.jsx)(y,{fulfillmentMode:t.fulfillmentMode,selectedPartnerId:t.selectedPartnerId,deliveryInfo:F,customerLocation:t.customerLocation})]}),(0,b.jsxs)("section",{className:"mt-6 space-y-3",children:[(0,b.jsx)("h3",{className:"text-sm font-semibold uppercase tracking-[0.25em] text-slate-500",children:"Método de pago"}),(0,b.jsx)("div",{className:"grid gap-3",children:g.map(a=>(0,b.jsx)("label",{className:`rounded-xl border p-3 transition ${J===a.id?"border-slate-900 bg-slate-900/5":"border-slate-200 hover:border-slate-300"}`,children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("input",{type:"radio",className:"mt-1 accent-slate-900",checked:J===a.id,onChange:()=>K(a.id)}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsx)("span",{className:"font-semibold text-slate-900",children:a.label}),(0,b.jsx)("span",{className:"rounded-full bg-slate-900/5 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-slate-600",children:a.currency})]}),a.description&&(0,b.jsx)("p",{className:"mt-1 text-sm text-slate-600",children:a.description})]})]})},a.id))})]}),(0,b.jsx)(w,{onBack:()=>q(1),onNext:()=>q(3),nextDisabled:!ac,nextLabel:"Confirmar medios",backLabel:"Regresar"})]}),3===p&&(0,b.jsxs)(v,{title:"3. Pago y recibo",children:[(0,b.jsxs)("section",{className:"space-y-4",children:[(0,b.jsx)(z,{method:L}),L.fields.length>0&&(0,b.jsx)("div",{className:"grid gap-4",children:L.fields.map(a=>(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-slate-700",children:a.label}),"select"===a.type?(0,b.jsxs)("select",{className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-200",value:M[a.id]??"",onChange:b=>N(c=>({...c,[a.id]:b.target.value})),children:[(0,b.jsx)("option",{value:"",children:"Selecciona…"}),(a.options??[]).map(a=>(0,b.jsx)("option",{value:a.value,children:a.label},a.value))]}):(0,b.jsx)("input",{type:"email"===a.type?"email":"text",placeholder:a.placeholder,className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-200",value:M[a.id]??"",onChange:b=>N(c=>({...c,[a.id]:b.target.value}))}),O[a.id]&&(0,b.jsx)("p",{className:"mt-1 text-xs text-red-600",children:O[a.id]})]},a.id))}),ad&&(0,b.jsx)("div",{className:"rounded-xl border border-blue-200 bg-blue-50 px-4 py-3 text-sm text-blue-800",children:$?"El pago con PayPal/Tarjeta será simulado en este entorno.":"Sin PayPal configurado: la simulación aprobará el pago automáticamente. Para producción, reemplaza este bloque con PayPalButtons."}),(0,b.jsxs)("section",{className:"space-y-3",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold text-slate-700",children:"¿Cómo prefieres recibir tu comprobante?"}),(0,b.jsxs)("div",{className:"grid gap-2 md:grid-cols-2",children:[(0,b.jsxs)("label",{className:`rounded-xl border px-3 py-2 text-sm ${"email"===Q?"border-slate-900 bg-slate-900/5":"border-slate-200 hover:border-slate-300"}`,children:[(0,b.jsx)("input",{type:"radio",name:"receipt",className:"mr-2 accent-slate-900",checked:"email"===Q,onChange:()=>R("email")}),"Enviar al correo: ",(0,b.jsx)("span",{className:"font-medium",children:t.email})]}),(0,b.jsxs)("label",{className:`rounded-xl border px-3 py-2 text-sm ${"phone"===Q?"border-slate-900 bg-slate-900/5":"border-slate-200 hover:border-slate-300"}`,children:[(0,b.jsx)("input",{type:"radio",name:"receipt",className:"mr-2 accent-slate-900",checked:"phone"===Q,onChange:()=>R("phone"),disabled:!t.phone}),"WhatsApp (",ab,")",!t.phone&&(0,b.jsx)("span",{className:"ml-2 text-xs text-slate-500",children:"Agrega un número en el paso 1"})]})]})]})]}),(0,b.jsx)(w,{onBack:()=>q(2),onNext:async()=>{let a={};if(L.fields.forEach(b=>{b.required&&!M[b.id]&&(a[b.id]="Requerido")}),"phone"!==Q||t.phone||(a.receipt="Debes registrar un número de teléfono"),P(a),!(Object.keys(a).length>0)){X("processing");try{let a={name:t.name,email:t.email,phone:t.phone||null,address:t.customerLocation?.label??"",method:J,currency:L.currency,amount:Math.round(100*aa),items:o.map(a=>({id:a.key,name:a.name,price:Math.round(a.total/a.quantity*100),quantity:a.quantity})),reference:(()=>{if(ad){let a=S??`mock-paypal-${Date.now()}`;return T(a),a}return M.reference??null})(),receiptPreference:Q,manualPaymentMethod:J,fulfillmentType:"pickup"===t.fulfillmentMode?"PICKUP":"DELIVERY",pickupLocationId:t.selectedPartnerId,pickupLocationName:s(t.selectedPartnerId)?.name??null,pickupLocationAddress:s(t.selectedPartnerId)?.address??null,fulfillmentLocationId:t.selectedPartnerId,deliveryEtaMinutes:F?.minutes??null,deliveryFee:F?Math.round(100*F.fee):0,customerCoordinates:t.customerLocation?{lat:t.customerLocation.lat,lng:t.customerLocation.lng}:null,partnerCoordinates:t.selectedPartnerId?{lat:s(t.selectedPartnerId)?.lat??null,lng:s(t.selectedPartnerId)?.lng??null}:null,metadata:{...M,...ad?{simulation:!0}:{},customerCoordinates:t.customerLocation,partnerCoordinates:t.selectedPartnerId?{lat:s(t.selectedPartnerId)?.lat??null,lng:s(t.selectedPartnerId)?.lng??null}:null}};console.log("submit-order payload:\n"+JSON.stringify(a,null,2));let b=await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!b.ok)throw Error("Order creation failed");let c=await b.json(),d=o.map(a=>({...a}));Z({items:d,baseTotal:m,deliveryFee:_,orderTotal:aa}),V(c),q(4),setTimeout(()=>i(),0)}catch(a){console.error(a),P(a=>({...a,root:"No se pudo procesar el pedido. Intenta nuevamente."}))}finally{X("idle")}}},nextDisabled:"processing"===W||"processing"===W,nextLabel:"Confirmar pedido",backLabel:"Regresar"}),O.root&&(0,b.jsx)("p",{className:"mt-3 text-sm text-red-600",children:O.root})]}),4===p&&(0,b.jsx)(v,{title:"4. Confirmación",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h2",{className:"text-2xl font-semibold text-slate-900",children:U?.status==="paid"?"¡Gracias por su compra!":"Gracias por su pedido"}),(0,b.jsx)("p",{className:"text-sm text-slate-700",children:U?.status==="paid"?"Hemos registrado el pago y enviaremos el comprobante según su preferencia.":"Su solicitud quedó en revisión. Validaremos el pago manual en menos de 48 horas y recibirá su comprobante."}),(0,b.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-white p-4 text-sm text-slate-700",children:[(0,b.jsxs)("p",{children:[(0,b.jsx)("span",{className:"font-semibold",children:"Número de seguimiento:"})," ",U?.id??"-"]}),(0,b.jsxs)("p",{className:"mt-2",children:[(0,b.jsx)("span",{className:"font-semibold",children:"Recibo vía:"})," ","email"===Q?t.email:ab]})]}),(0,b.jsx)("button",{className:"btn btn-outline",onClick:()=>a.push("/"),children:"Volver al inicio"})]})})]}),(0,b.jsx)("aside",{className:"space-y-4",children:(0,b.jsx)(A,{items:Y?.items??o,baseTotal:Y?.baseTotal??m,deliveryFee:Y?.deliveryFee??_,orderTotal:Y?.orderTotal??aa,deliveryInfo:"delivery"===t.fulfillmentMode?F:null})})]})]}):(0,b.jsxs)("div",{className:"container-edge py-16 text-center",children:[(0,b.jsx)("h1",{className:"text-2xl font-semibold",children:"Checkout"}),(0,b.jsx)("p",{className:"mt-2 text-sm text-slate-600",children:"Cargando detalles del pedido…"})]}):(0,b.jsxs)("div",{className:"container-edge py-16 text-center",children:[(0,b.jsx)("h1",{className:"text-2xl font-semibold",children:"Tu carrito está vacío"}),(0,b.jsx)("p",{className:"mt-3 text-sm text-slate-600",children:"Agrega productos para iniciar el proceso de compra."})]})}function u({currentStep:a}){return(0,b.jsx)("div",{className:"mt-6 grid gap-3 md:grid-cols-4",children:["Información","Entrega","Pago","Confirmación"].map((c,d)=>{let e=d+1;return(0,b.jsxs)("div",{className:`rounded-2xl border px-4 py-3 text-sm transition ${a===e?"border-slate-900 bg-slate-900 text-white":a>e?"border-emerald-400 bg-emerald-50 text-emerald-700":"border-slate-200 bg-white text-slate-600"}`,children:[(0,b.jsxs)("div",{className:"text-xs uppercase tracking-[0.3em]",children:["Paso ",d+1]}),(0,b.jsx)("div",{className:"mt-1 font-semibold",children:c})]},c)})})}function v({title:a,children:c}){return(0,b.jsxs)("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:a}),(0,b.jsx)("div",{className:"mt-4 space-y-4",children:c})]})}function w({onBack:a,onNext:c,nextDisabled:d,nextLabel:e,backLabel:f}){return(0,b.jsxs)("div",{className:"flex flex-col gap-3 pt-4 sm:flex-row sm:justify-end",children:[a&&(0,b.jsx)("button",{onClick:a,type:"button",className:"btn btn-outline sm:w-auto",children:f??"Anterior"}),(0,b.jsx)("button",{type:"button",className:"btn btn-primary sm:w-auto",disabled:d,onClick:c,children:e})]})}function x({label:a,description:c,selected:d,onClick:e}){return(0,b.jsxs)("button",{type:"button",onClick:e,className:`rounded-2xl border px-4 py-3 text-left transition ${d?"border-slate-900 bg-slate-900/5":"border-slate-200 hover:border-slate-300"}`,children:[(0,b.jsx)("div",{className:"font-semibold text-slate-900",children:a}),(0,b.jsx)("p",{className:"mt-1 text-xs text-slate-600",children:c})]})}function y({fulfillmentMode:a,selectedPartnerId:c,deliveryInfo:d,customerLocation:e}){let f=c?s(c):null;if(!f)return(0,b.jsx)("div",{className:"rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-600",children:"Selecciona un aliado en el paso anterior."});let g=e?(B(e.lat,e.lng,f.lat,f.lng)/1e3).toFixed(1):null;return"pickup"===a?(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-slate-900/5 p-4",children:[(0,b.jsx)("div",{className:"text-sm font-semibold text-slate-900",children:f.name}),(0,b.jsx)("p",{className:"text-xs text-slate-600",children:f.address}),(0,b.jsx)("p",{className:"text-[11px] uppercase tracking-wide text-slate-400",children:f.cityState}),g&&e&&(0,b.jsxs)("p",{className:"mt-2 text-xs text-slate-500",children:["Aproximadamente ",g," km desde tu ubicación."]})]}):d?(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-slate-900/5 p-4",children:[(0,b.jsxs)("div",{className:"text-sm font-semibold text-slate-900",children:["Aliado asignado: ",f.name]}),(0,b.jsx)("p",{className:"text-xs text-slate-600",children:f.address}),(0,b.jsx)("p",{className:"text-[11px] uppercase tracking-wide text-slate-400",children:f.cityState}),(0,b.jsxs)("div",{className:"mt-3 flex flex-wrap items-center gap-3 text-xs text-slate-700",children:[(0,b.jsxs)("span",{className:"rounded-full bg-slate-900/5 px-2 py-1 font-semibold",children:["Estimado: ",d.minutes," min"]}),(0,b.jsxs)("span",{className:"rounded-full bg-slate-900/5 px-2 py-1 font-semibold",children:["Cobrado: ",d.minutesCapped," min"]}),(0,b.jsxs)("span",{className:"rounded-full bg-slate-900/5 px-2 py-1 font-semibold",children:["Cargo adicional: $",d.fee.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"mt-2 text-xs text-slate-500",children:["Fuente: ","ors"===d.source?"Ruta ORS":"Estimación"]}),g&&(0,b.jsxs)("div",{className:"mt-4 text-xs text-slate-600",children:["Distancia aproximada: ",g," km."]}),(0,b.jsx)("div",{className:"mt-4 rounded-xl border border-dashed border-slate-300 bg-white px-3 py-2 text-xs text-slate-600",children:"El costo de envío se calcula a $0.50 por minuto (máximo 45 minutos), utilizando el aliado sugerido."})]}):(0,b.jsx)("div",{className:"rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-600",children:"Calcularemos el aliado más cercano una vez ingreses tu dirección completa."})}function z({method:a}){return(0,b.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-slate-900/5 p-4",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold uppercase tracking-[0.2em] text-slate-500",children:"Instrucciones"}),(0,b.jsx)("ul",{className:"mt-3 space-y-1 text-sm text-slate-700",children:a.merchantInfo.map(a=>(0,b.jsxs)("li",{className:"flex items-center justify-between gap-4",children:[(0,b.jsx)("span",{className:"text-slate-500",children:a.label}),(0,b.jsx)("span",{className:"font-semibold text-slate-900",children:a.value})]},a.label))})]})}function A({items:a,baseTotal:c,deliveryFee:d,orderTotal:e,deliveryInfo:f}){return(0,b.jsxs)("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Resumen del pedido"}),(0,b.jsx)("div",{className:"mt-4 space-y-3 text-sm text-slate-700",children:a.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("span",{children:[a.name," × ",a.quantity]}),(0,b.jsxs)("span",{children:["$",a.total.toFixed(2)]})]},a.key))}),(0,b.jsxs)("div",{className:"mt-4 border-t border-slate-200 pt-4 text-sm text-slate-700",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{children:"Subtotal"}),(0,b.jsxs)("span",{children:["$",c.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between text-slate-500",children:[(0,b.jsx)("span",{children:"Envío"}),(0,b.jsx)("span",{children:f?`$${d.toFixed(2)}`:"$0.00"})]}),(0,b.jsxs)("div",{className:"mt-3 flex items-center justify-between text-base font-semibold text-slate-900",children:[(0,b.jsx)("span",{children:"Total"}),(0,b.jsxs)("span",{children:["$",e.toFixed(2)]})]})]}),f&&(0,b.jsxs)("div",{className:"mt-4 rounded-xl border border-slate-200 bg-slate-900/5 px-3 py-2 text-xs text-slate-600",children:["Envío calculado ","ors"===f.source?"con ORS":"con estimación",". Distancia aproximada: ",f.distanceMeters?`${(f.distanceMeters/1e3).toFixed(1)} km`:"N/D","."]})]})}function B(a,b,c,d){let e=a=>a*Math.PI/180,f=e(a),g=e(c),h=Math.sin(e(c-a)/2)**2+Math.cos(f)*Math.cos(g)*Math.sin(e(d-b)/2)**2;return 2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h))*6371e3}}];

//# sourceMappingURL=_9c4671f8._.js.map