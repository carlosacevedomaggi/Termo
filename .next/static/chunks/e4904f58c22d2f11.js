(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,67585,(e,t,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),Object.defineProperty(l,"BailoutToCSR",{enumerable:!0,get:function(){return s}});let a=e.r(32061);function s(e){let{reason:t,children:l}=e;if("undefined"==typeof window)throw Object.defineProperty(new a.BailoutToCSRError(t),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return l}},9885,(e,t,l)=>{"use strict";function a(e){return e.split("/").map(e=>encodeURIComponent(e)).join("/")}Object.defineProperty(l,"__esModule",{value:!0}),Object.defineProperty(l,"encodeURIPath",{enumerable:!0,get:function(){return a}})},52157,(e,t,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),Object.defineProperty(l,"PreloadChunks",{enumerable:!0,get:function(){return i}});let a=e.r(43476),s=e.r(74080),n=e.r(63599),r=e.r(9885);function i(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let l=n.workAsyncStorage.getStore();if(void 0===l)return null;let i=[];if(l.reactLoadableManifest&&t){let e=l.reactLoadableManifest;for(let l of t){if(!e[l])continue;let t=e[l].files;i.push(...t)}}return 0===i.length?null:(0,a.jsx)(a.Fragment,{children:i.map(e=>{let t=l.assetPrefix+"/_next/"+(0,r.encodeURIPath)(e);return e.endsWith(".css")?(0,a.jsx)("link",{precedence:"dynamic",href:t,rel:"stylesheet",as:"style"},e):((0,s.preload)(t,{as:"script",fetchPriority:"low"}),null)})})}},69093,(e,t,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),Object.defineProperty(l,"default",{enumerable:!0,get:function(){return d}});let a=e.r(43476),s=e.r(71645),n=e.r(67585),r=e.r(52157);function i(e){return{default:e&&"default"in e?e.default:e}}let o={loader:()=>Promise.resolve(i(()=>null)),loading:null,ssr:!0},d=function(e){let t={...o,...e},l=(0,s.lazy)(()=>t.loader().then(i)),d=t.loading;function c(e){let i=d?(0,a.jsx)(d,{isLoading:!0,pastDelay:!0,error:null}):null,o=!t.ssr||!!t.loading,c=o?s.Suspense:s.Fragment,u=t.ssr?(0,a.jsxs)(a.Fragment,{children:["undefined"==typeof window?(0,a.jsx)(r.PreloadChunks,{moduleIds:t.modules}):null,(0,a.jsx)(l,{...e})]}):(0,a.jsx)(n.BailoutToCSR,{reason:"next/dynamic",children:(0,a.jsx)(l,{...e})});return(0,a.jsx)(c,{...o?{fallback:i}:{},children:u})}return c.displayName="LoadableComponent",c}},70703,(e,t,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),Object.defineProperty(l,"default",{enumerable:!0,get:function(){return s}});let a=e.r(55682)._(e.r(69093));function s(e,t){var l;let s={};"function"==typeof e&&(s.loader=e);let n={...s,...t};return(0,a.default)({...n,modules:null==(l=n.loadableGenerated)?void 0:l.modules})}("function"==typeof l.default||"object"==typeof l.default&&null!==l.default)&&void 0===l.default.__esModule&&(Object.defineProperty(l.default,"__esModule",{value:!0}),Object.assign(l.default,l),t.exports=l.default)},78333,(e,t,l)=>{var a=0/0,s=/^\s+|\s+$/g,n=/^[-+]0x[0-9a-f]+$/i,r=/^0b[01]+$/i,i=/^0o[0-7]+$/i,o=parseInt,d=e.g&&e.g.Object===Object&&e.g,c="object"==typeof self&&self&&self.Object===Object&&self,u=d||c||Function("return this")(),m=Object.prototype.toString,x=Math.max,p=Math.min,f=function(){return u.Date.now()};function b(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function h(e){if("number"==typeof e)return e;if("symbol"==typeof(t=e)||t&&"object"==typeof t&&"[object Symbol]"==m.call(t))return a;if(b(e)){var t,l="function"==typeof e.valueOf?e.valueOf():e;e=b(l)?l+"":l}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(s,"");var d=r.test(e);return d||i.test(e)?o(e.slice(2),d?2:8):n.test(e)?a:+e}t.exports=function(e,t,l){var a,s,n,r,i,o,d=0,c=!1,u=!1,m=!0;if("function"!=typeof e)throw TypeError("Expected a function");function y(t){var l=a,n=s;return a=s=void 0,d=t,r=e.apply(n,l)}function j(e){var l=e-o,a=e-d;return void 0===o||l>=t||l<0||u&&a>=n}function v(){var e,l,a,s=f();if(j(s))return g(s);i=setTimeout(v,(e=s-o,l=s-d,a=t-e,u?p(a,n-l):a))}function g(e){return(i=void 0,m&&a)?y(e):(a=s=void 0,r)}function N(){var e,l=f(),n=j(l);if(a=arguments,s=this,o=l,n){if(void 0===i)return d=e=o,i=setTimeout(v,t),c?y(e):r;if(u)return i=setTimeout(v,t),y(o)}return void 0===i&&(i=setTimeout(v,t)),r}return t=h(t)||0,b(l)&&(c=!!l.leading,n=(u="maxWait"in l)?x(h(l.maxWait)||0,t):n,m="trailing"in l?!!l.trailing:m),N.cancel=function(){void 0!==i&&clearTimeout(i),d=0,a=o=s=i=void 0},N.flush=function(){return void 0===i?r:g(f())},N}},69439,e=>{"use strict";e.s(["default",()=>j],69439);var t=e.i(43476),l=e.i(71645),a=e.i(18566),s=e.i(9666);let n={zelleName:"INDUSTRIAS TERMOTRONIC",zelleEmail:"pagos@termotronic.com",pmFullName:"INDUSTRIAS TERMOTRONIC",pmPhone:"0412-TERMOTRO",pmNationalId:"J-301781899",pmBankName:"Banesco",pmBankCode:"0134",bankFullName:"INDUSTRIAS TERMOTRONIC",bankNationalId:"J-301781899",bankName:"Banesco",bankAccountType:"Cuenta Verde Efectivo US$",bankAccountNumber:"01341740720021814454"},r=[{id:"paypal",label:"PayPal (USD)",description:"Pay using your PayPal account",currency:"USD",merchantInfo:[{label:"PayPal Business",value:"paypal@termotronic.com"}],fields:[{id:"paypalEmail",label:"Correo PayPal",type:"email",required:!0},{id:"paypalTxn",label:"ID de transacción (opcional)",type:"text",placeholder:"p. ej. 9AB12345CD6789012"}]},{id:"card",label:"Credit/Debit Card",description:"Pay securely with your card",currency:"USD",merchantInfo:[{label:"Proveedor",value:"PayPal Checkout"},{label:"Tarjetas",value:"Visa, Mastercard, American Express"}],fields:[{id:"cardHolder",label:"Nombre en la tarjeta",type:"text",required:!0},{id:"cardEmail",label:"Correo del titular",type:"email",required:!0}]},{id:"zelle",label:"Zelle (USD)",description:"Transfer via Zelle in USD",currency:"USD",merchantInfo:[{label:"Recipient name",value:n.zelleName},{label:"Zelle email",value:n.zelleEmail}],fields:[{id:"senderName",label:"Nombre del remitente",type:"text",required:!0},{id:"senderEmail",label:"Correo del remitente",type:"email",required:!0},{id:"confirmation",label:"Número de confirmación (opcional)",type:"text",placeholder:"p. ej. ABC123"}]},{id:"pagomovil",label:"Pago Móvil (VES)",description:"Pago móvil interbancario en bolívares",currency:"VES",merchantInfo:[{label:"Banco",value:"".concat(n.pmBankName," (").concat(n.pmBankCode,")")},{label:"Titular",value:n.pmFullName},{label:"Teléfono",value:n.pmPhone},{label:"Cédula/RIF",value:n.pmNationalId}],fields:[{id:"payerPhone",label:"Tu teléfono (Pago Móvil)",type:"text",required:!0,placeholder:"04xx-xxxxxxx"},{id:"payerId",label:"Tu cédula/RIF",type:"text",required:!0,placeholder:"V-xxxxxxx"},{id:"payerBank",label:"Tu banco",type:"select",required:!0,options:[{label:"Banco de Venezuela (0102)",value:"0102"},{label:"Banesco (0134)",value:"0134"},{label:"Mercantil (0105)",value:"0105"},{label:"Provincial (0108)",value:"0108"},{label:"BNC (0191)",value:"0191"}]},{id:"reference",label:"Referencia de pago",type:"text",required:!0}]},{id:"bank",label:"Depósito Banesco Verde (USD)",description:"Depósito directo en cuenta Banesco Verde en dólares",currency:"USD",merchantInfo:[{label:"Banco",value:n.bankName},{label:"Tipo de cuenta",value:n.bankAccountType},{label:"Nº de cuenta",value:n.bankAccountNumber},{label:"Titular",value:n.bankFullName},{label:"RIF",value:n.bankNationalId},{label:"Instrucción",value:"Deposita en taquilla y envía el comprobante a tienda@termotronic.com"}],fields:[{id:"depositDate",label:"Fecha del depósito",type:"text",required:!0,placeholder:"DD/MM/AAAA"},{id:"reference",label:"Número de comprobante",type:"text",required:!0}]}];var i=e.i(58235),o=e.i(70703),d=e.i(78333);function c(e,t,l,a){let s=e=>e*Math.PI/180,n=s(e),r=s(l),i=Math.sin(s(l-e)/2)**2+Math.cos(n)*Math.cos(r)*Math.sin(s(a-t)/2)**2;return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371e3}function u(e,t,l){return[...e].sort((e,a)=>c(t,l,e.lat,e.lng)-c(t,l,a.lat,a.lng))}let m=(0,o.default)(()=>e.A(4306),{loadableGenerated:{modules:[55547]},ssr:!1});function x(e){let{partners:a,value:s,onChange:n,errors:r,onErrorsChange:i,onComplete:o}=e,[c,x]=(0,l.useState)(""),[h,y]=(0,l.useState)([]),[j,v]=(0,l.useState)(!1);(0,l.useEffect)(()=>{var e,t;x(null!=(t=null==(e=s.customerLocation)?void 0:e.label)?t:"")},[s.customerLocation]);let g=(0,l.useMemo)(()=>s.customerLocation?u(a,s.customerLocation.lat,s.customerLocation.lng).slice(0,5):a.slice(0,5),[a,s.customerLocation]);(0,l.useMemo)(()=>{var e;return null!=(e=a.find(e=>e.id===s.selectedPartnerId))?e:null},[a,s.selectedPartnerId]);let N=(0,l.useMemo)(()=>(0,d.default)(async e=>{if(!e.trim())return void y([]);v(!0);try{let t=await fetch("/api/geocode",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e})});if(!t.ok)return void console.error("Geocode failed",await t.text());let l=await t.json();y(l.results)}catch(e){console.error("Geocode error",e)}finally{v(!1)}},400),[]);(0,l.useEffect)(()=>{var e;c&&c!==(null==(e=s.customerLocation)?void 0:e.label)?N(c):y([])},[c,s.customerLocation,N]);let P=e=>{var t,l;n({...s,customerLocation:e,selectedPartnerId:null!=(l=null==(t=u(a,e.lat,e.lng)[0])?void 0:t.id)?l:null}),i({...r,customerLocation:""})};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsx)(p,{label:"Nombre completo",value:s.name,onChange:e=>n({...s,name:e}),error:r.name,required:!0}),(0,t.jsx)(p,{label:"Correo electrónico",type:"email",value:s.email,onChange:e=>n({...s,email:e}),error:r.email,required:!0}),(0,t.jsx)(p,{label:"Teléfono (opcional)",value:s.phone,onChange:e=>n({...s,phone:e})})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("label",{className:"text-sm font-semibold uppercase tracking-[0.25em] text-slate-500",children:"Modalidad"}),(0,t.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,t.jsx)(f,{label:"Retiro en distribuidor",description:"Elige el aliado más conveniente.",selected:"pickup"===s.fulfillmentMode,onClick:()=>n({...s,fulfillmentMode:"pickup"})}),(0,t.jsx)(f,{label:"Entrega a domicilio",description:"Coordinamos la entrega con el aliado más cercano.",selected:"delivery"===s.fulfillmentMode,onClick:()=>n({...s,fulfillmentMode:"delivery"})})]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("label",{className:"text-sm font-semibold uppercase tracking-[0.25em] text-slate-500",children:"pickup"===s.fulfillmentMode?"Selecciona tu punto aliado":"Dirección de entrega"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("input",{value:c,onChange:e=>x(e.target.value),placeholder:"pickup"===s.fulfillmentMode?"Busca tu dirección o tu aliado":"Escribe tu dirección",className:"w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-200"}),j&&(0,t.jsx)("p",{className:"text-xs text-slate-500",children:"Buscando…"}),h.length>0&&(0,t.jsx)("div",{className:"max-h-48 overflow-y-auto rounded-xl border border-slate-200 bg-white shadow-sm",children:h.map(e=>(0,t.jsxs)("button",{type:"button",onClick:()=>{P({lat:e.lat,lng:e.lng,label:e.label}),y([]),x(e.label)},className:"flex w-full flex-col items-start px-3 py-2 text-left text-sm hover:bg-slate-100",children:[(0,t.jsx)("span",{className:"font-medium text-slate-900",children:e.name}),(0,t.jsx)("span",{className:"text-xs text-slate-600",children:e.locality?"".concat(e.locality," • ").concat(e.label):e.label})]},e.id))}),r.customerLocation&&(0,t.jsx)("p",{className:"text-xs text-red-600",children:r.customerLocation})]})]}),(0,t.jsx)("div",{className:"h-80 overflow-hidden rounded-2xl border border-slate-200",children:(0,t.jsx)(m,{customerLocation:s.customerLocation,partners:a,fulfillmentMode:s.fulfillmentMode,selectedPartnerId:s.selectedPartnerId,onCustomerLocationChange:P,onSelectPartner:e=>n({...s,selectedPartnerId:e})})}),"pickup"===s.fulfillmentMode&&(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-slate-700",children:"Aliados sugeridos"}),(0,t.jsx)(b,{options:g,selectedId:s.selectedPartnerId,onSelect:e=>n({...s,selectedPartnerId:e})}),r.selectedPartnerId&&(0,t.jsx)("p",{className:"text-xs text-red-600",children:r.selectedPartnerId})]}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)("button",{type:"button",className:"btn btn-primary",onClick:()=>{let e={};s.name.trim()||(e.name="Requerido"),s.email.trim()||(e.email="Requerido"),s.customerLocation||(e.customerLocation="Selecciona una ubicación"),"pickup"!==s.fulfillmentMode||s.selectedPartnerId||(e.selectedPartnerId="Selecciona un aliado"),i(e),0===Object.keys(e).length&&o()},children:"Continuar"})})]})}function p(e){let{label:l,value:a,onChange:s,error:n,required:r,type:i="text"}=e;return(0,t.jsxs)("label",{className:"block text-sm font-medium text-slate-700",children:[l,(0,t.jsx)("input",{type:i,value:a,required:r,onChange:e=>s(e.target.value),className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-200"}),n&&(0,t.jsx)("span",{className:"mt-1 block text-xs text-red-600",children:n})]})}function f(e){let{label:l,description:a,selected:s,onClick:n}=e;return(0,t.jsxs)("button",{type:"button",onClick:n,className:"rounded-2xl border px-4 py-3 text-left transition ".concat(s?"border-slate-900 bg-slate-900/5":"border-slate-200 hover:border-slate-300"),children:[(0,t.jsx)("div",{className:"font-semibold text-slate-900",children:l}),(0,t.jsx)("p",{className:"mt-1 text-xs text-slate-600",children:a})]})}function b(e){let{options:l,selectedId:a,onSelect:s}=e;return(0,t.jsx)("div",{className:"space-y-2",children:l.map(e=>(0,t.jsxs)("button",{type:"button",onClick:()=>s(e.id),className:"flex w-full items-start justify-between rounded-xl border px-3 py-2 text-left text-sm transition ".concat(a===e.id?"border-slate-900 bg-slate-900/5":"border-slate-200 hover:border-slate-300"),children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-semibold text-slate-900",children:e.name}),(0,t.jsx)("div",{className:"text-xs text-slate-600",children:e.address}),(0,t.jsx)("div",{className:"text-[11px] uppercase tracking-wide text-slate-400",children:e.cityState})]}),(0,t.jsx)("div",{className:"text-xs text-slate-500",children:a===e.id?"Seleccionado":"Elegir"})]},e.id))})}let h=Object.entries(e.i(56264).default).map(e=>{let[t,l]=e;return{id:t,type:l.type,name:l.name,address:l.address,cityState:l.cityState,lat:l.lat,lng:l.lng,source:l.source}});function y(e){var t;return e&&null!=(t=h.find(t=>t.id===e))?t:null}function j(){var e,n,o,d,c,u,m;let p=(0,a.useRouter)(),{items:f,clear:b}=(0,s.useCartStore)(),[j,I]=(0,l.useState)(!1);(0,l.useEffect)(()=>{I(!0)},[]);let w=(0,l.useMemo)(()=>h.filter(e=>"distributor"===e.type),[]),T=(0,l.useMemo)(()=>f.reduce((e,t)=>{var l;return e+t.price*(null!=(l=t.quantity)?l:1)},0),[f]),E=(0,l.useMemo)(()=>f.map(e=>{var t,l;return{key:e.id,name:e.name,quantity:null!=(t=e.quantity)?t:1,total:e.price*(null!=(l=e.quantity)?l:1)}}),[f]),[L,O]=(0,l.useState)(1),[R,D]=(0,l.useState)({name:"",email:"",phone:"",fulfillmentMode:"pickup",customerLocation:null,selectedPartnerId:null}),[q,A]=(0,l.useState)({}),[B,F]=(0,l.useState)(null);async function _(e,t,l){try{var a,s;let n=await fetch("/api/directions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({start:{lat:e,lng:t},end:{lat:l.lat,lng:l.lng}})});if(!n.ok){let a=await n.text();return console.warn("Directions failed",a),U(e,t,l)}let r=await n.json(),i=Math.round((null!=(a=r.duration)?a:0)/60),o=Math.min(i,45);return{partnerId:l.id,partnerName:l.name,partnerAddress:l.address,partnerCityState:l.cityState,minutes:i,minutesCapped:o,fee:.5*o,distanceMeters:null!=(s=r.distance)?s:null,source:"ors"}}catch(a){return console.warn("Directions error",a),U(e,t,l)}}function U(e,t,l){let a=S(e,t,l.lat,l.lng),s=Math.round(a/1e3/40*60),n=Math.max(10,Math.min(s,45));return{partnerId:l.id,partnerName:l.name,partnerAddress:l.address,partnerCityState:l.cityState,minutes:s,minutesCapped:n,fee:.5*n,distanceMeters:a,source:"fallback"}}(0,l.useEffect)(()=>{if(!R.customerLocation||"delivery"!==R.fulfillmentMode||!R.selectedPartnerId)return void F(null);let e=y(R.selectedPartnerId);if(!e)return void F(null);_(R.customerLocation.lat,R.customerLocation.lng,{id:e.id,name:e.name,address:e.address,cityState:e.cityState,lat:e.lat,lng:e.lng}).then(e=>{e&&F(e)})},[R.customerLocation,R.fulfillmentMode,R.selectedPartnerId]);let[$,V]=(0,l.useState)(null!=(n=null==(e=r[0])?void 0:e.id)?n:"paypal"),z=(0,l.useMemo)(()=>r.find(e=>e.id===$),[$]),[G,J]=(0,l.useState)({}),[W,K]=(0,l.useState)({}),[Z,H]=(0,l.useState)("email"),[X,Y]=(0,l.useState)(null),[Q,ee]=(0,l.useState)(null),[et,el]=(0,l.useState)("idle"),[ea,es]=(0,l.useState)(null),{isConfigured:en}=(0,i.usePayPalConfig)(),er="delivery"===R.fulfillmentMode&&B?B.fee:0,ei=T+er,eo=R.phone?"***-".concat(R.phone.slice(-3)):"No proporcionado",ed="pickup"===R.fulfillmentMode&&R.selectedPartnerId||"delivery"===R.fulfillmentMode&&B,ec="paypal"===$||"card"===$;return f.length||ea||4===L?j?(0,t.jsxs)("div",{className:"container-edge py-12",children:[(0,t.jsx)("h1",{className:"text-3xl font-semibold",children:"Checkout"}),(0,t.jsx)(v,{currentStep:L}),(0,t.jsxs)("div",{className:"mt-8 grid gap-8 lg:grid-cols-[minmax(0,1fr)_minmax(320px,0.7fr)]",children:[(0,t.jsxs)("div",{className:"space-y-6",children:[1===L&&(0,t.jsx)(g,{title:"1. Información y ubicación",children:(0,t.jsx)(x,{partners:w,value:R,onChange:e=>D(e),errors:q,onErrorsChange:A,onComplete:()=>O(2)})}),2===L&&(0,t.jsxs)(g,{title:"2. Entrega y método de pago",children:[(0,t.jsxs)("section",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold uppercase tracking-[0.25em] text-slate-500",children:"Modalidad"}),(0,t.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,t.jsx)(P,{label:"Retiro en distribuidor",description:"Elige el punto aliado más conveniente para retirar tu pedido.",selected:"pickup"===R.fulfillmentMode,onClick:()=>{D(e=>({...e,fulfillmentMode:"pickup"})),F(null)}}),(0,t.jsx)(P,{label:"Entrega a domicilio",description:"Coordinamos con el aliado más cercano y calculamos el cargo de envío.",selected:"delivery"===R.fulfillmentMode,onClick:async()=>{let e=R.selectedPartnerId?y(R.selectedPartnerId):null;D(e=>({...e,fulfillmentMode:"delivery"})),e&&R.customerLocation&&_(R.customerLocation.lat,R.customerLocation.lng,{id:e.id,name:e.name,address:e.address,cityState:e.cityState,lat:e.lat,lng:e.lng}).then(e=>{e&&F(e)})}})]})]}),(0,t.jsxs)("section",{className:"mt-6 space-y-3",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold uppercase tracking-[0.25em] text-slate-500",children:"pickup"===R.fulfillmentMode?"Aliado seleccionado":"Entrega coordinada"}),(0,t.jsx)(k,{fulfillmentMode:R.fulfillmentMode,selectedPartnerId:R.selectedPartnerId,deliveryInfo:B,customerLocation:R.customerLocation})]}),(0,t.jsxs)("section",{className:"mt-6 space-y-3",children:[(0,t.jsx)("h3",{className:"text-sm font-semibold uppercase tracking-[0.25em] text-slate-500",children:"Método de pago"}),(0,t.jsx)("div",{className:"grid gap-3",children:r.map(e=>(0,t.jsx)("label",{className:"rounded-xl border p-3 transition ".concat($===e.id?"border-slate-900 bg-slate-900/5":"border-slate-200 hover:border-slate-300"),children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("input",{type:"radio",className:"mt-1 accent-slate-900",checked:$===e.id,onChange:()=>V(e.id)}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsx)("span",{className:"font-semibold text-slate-900",children:e.label}),(0,t.jsx)("span",{className:"rounded-full bg-slate-900/5 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-wide text-slate-600",children:e.currency})]}),e.description&&(0,t.jsx)("p",{className:"mt-1 text-sm text-slate-600",children:e.description})]})]})},e.id))})]}),(0,t.jsx)(N,{onBack:()=>O(1),onNext:()=>O(3),nextDisabled:!ed,nextLabel:"Confirmar medios",backLabel:"Regresar"})]}),3===L&&(0,t.jsxs)(g,{title:"3. Pago y recibo",children:[(0,t.jsxs)("section",{className:"space-y-4",children:[(0,t.jsx)(M,{method:z}),z.fields.length>0&&(0,t.jsx)("div",{className:"grid gap-4",children:z.fields.map(e=>{var l,a,s;return(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-sm font-medium text-slate-700",children:e.label}),"select"===e.type?(0,t.jsxs)("select",{className:"mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-200",value:null!=(l=G[e.id])?l:"",onChange:t=>J(l=>({...l,[e.id]:t.target.value})),children:[(0,t.jsx)("option",{value:"",children:"Selecciona…"}),(null!=(a=e.options)?a:[]).map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))]}):(0,t.jsx)("input",{type:"email"===e.type?"email":"text",placeholder:e.placeholder,className:"mt-1 w-full rounded-xl border border-slate-200 px-3 py-2 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-200",value:null!=(s=G[e.id])?s:"",onChange:t=>J(l=>({...l,[e.id]:t.target.value}))}),W[e.id]&&(0,t.jsx)("p",{className:"mt-1 text-xs text-red-600",children:W[e.id]})]},e.id)})}),ec&&(0,t.jsx)("div",{className:"rounded-xl border border-blue-200 bg-blue-50 px-4 py-3 text-sm text-blue-800",children:en?"El pago con PayPal/Tarjeta será simulado en este entorno.":"Sin PayPal configurado: la simulación aprobará el pago automáticamente. Para producción, reemplaza este bloque con PayPalButtons."}),(0,t.jsxs)("section",{className:"space-y-3",children:[(0,t.jsx)("h4",{className:"text-sm font-semibold text-slate-700",children:"¿Cómo prefieres recibir tu comprobante?"}),(0,t.jsxs)("div",{className:"grid gap-2 md:grid-cols-2",children:[(0,t.jsxs)("label",{className:"rounded-xl border px-3 py-2 text-sm ".concat("email"===Z?"border-slate-900 bg-slate-900/5":"border-slate-200 hover:border-slate-300"),children:[(0,t.jsx)("input",{type:"radio",name:"receipt",className:"mr-2 accent-slate-900",checked:"email"===Z,onChange:()=>H("email")}),"Enviar al correo: ",(0,t.jsx)("span",{className:"font-medium",children:R.email})]}),(0,t.jsxs)("label",{className:"rounded-xl border px-3 py-2 text-sm ".concat("phone"===Z?"border-slate-900 bg-slate-900/5":"border-slate-200 hover:border-slate-300"),children:[(0,t.jsx)("input",{type:"radio",name:"receipt",className:"mr-2 accent-slate-900",checked:"phone"===Z,onChange:()=>H("phone"),disabled:!R.phone}),"WhatsApp (",eo,")",!R.phone&&(0,t.jsx)("span",{className:"ml-2 text-xs text-slate-500",children:"Agrega un número en el paso 1"})]})]})]})]}),(0,t.jsx)(N,{onBack:()=>O(2),onNext:async()=>{let e={};if(z.fields.forEach(t=>{t.required&&!G[t.id]&&(e[t.id]="Requerido")}),"phone"!==Z||R.phone||(e.receipt="Debes registrar un número de teléfono"),K(e),!(Object.keys(e).length>0)){el("processing");try{var t,l,a,s,n,r,i,o,d,c,u,m,x,p,f;let e={name:R.name,email:R.email,phone:R.phone||null,address:null!=(o=null==(t=R.customerLocation)?void 0:t.label)?o:"",method:$,currency:z.currency,amount:Math.round(100*ei),items:E.map(e=>({id:e.key,name:e.name,price:Math.round(e.total/e.quantity*100),quantity:e.quantity})),reference:(()=>{var e;if(ec){let e=null!=X?X:"mock-paypal-".concat(Date.now());return Y(e),e}return null!=(e=G.reference)?e:null})(),receiptPreference:Z,manualPaymentMethod:$,fulfillmentType:"pickup"===R.fulfillmentMode?"PICKUP":"DELIVERY",pickupLocationId:R.selectedPartnerId,pickupLocationName:null!=(d=null==(l=y(R.selectedPartnerId))?void 0:l.name)?d:null,pickupLocationAddress:null!=(c=null==(a=y(R.selectedPartnerId))?void 0:a.address)?c:null,fulfillmentLocationId:R.selectedPartnerId,deliveryEtaMinutes:null!=(u=null==B?void 0:B.minutes)?u:null,deliveryFee:B?Math.round(100*B.fee):0,customerCoordinates:R.customerLocation?{lat:R.customerLocation.lat,lng:R.customerLocation.lng}:null,partnerCoordinates:R.selectedPartnerId?{lat:null!=(m=null==(s=y(R.selectedPartnerId))?void 0:s.lat)?m:null,lng:null!=(x=null==(n=y(R.selectedPartnerId))?void 0:n.lng)?x:null}:null,metadata:{...G,...ec?{simulation:!0}:{},customerCoordinates:R.customerLocation,partnerCoordinates:R.selectedPartnerId?{lat:null!=(p=null==(r=y(R.selectedPartnerId))?void 0:r.lat)?p:null,lng:null!=(f=null==(i=y(R.selectedPartnerId))?void 0:i.lng)?f:null}:null}};console.log("submit-order payload:\n"+JSON.stringify(e,null,2));let h=await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!h.ok)throw Error("Order creation failed");let j=await h.json(),v=E.map(e=>({...e}));es({items:v,baseTotal:T,deliveryFee:er,orderTotal:ei}),ee(j),O(4),setTimeout(()=>b(),0)}catch(e){console.error(e),K(e=>({...e,root:"No se pudo procesar el pedido. Intenta nuevamente."}))}finally{el("idle")}}},nextDisabled:"processing"===et||"processing"===et,nextLabel:"Confirmar pedido",backLabel:"Regresar"}),W.root&&(0,t.jsx)("p",{className:"mt-3 text-sm text-red-600",children:W.root})]}),4===L&&(0,t.jsx)(g,{title:"4. Confirmación",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold text-slate-900",children:(null==Q?void 0:Q.status)==="paid"?"¡Gracias por su compra!":"Gracias por su pedido"}),(0,t.jsx)("p",{className:"text-sm text-slate-700",children:(null==Q?void 0:Q.status)==="paid"?"Hemos registrado el pago y enviaremos el comprobante según su preferencia.":"Su solicitud quedó en revisión. Validaremos el pago manual en menos de 48 horas y recibirá su comprobante."}),(0,t.jsxs)("div",{className:"rounded-xl border border-slate-200 bg-white p-4 text-sm text-slate-700",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("span",{className:"font-semibold",children:"Número de seguimiento:"})," ",null!=(o=null==Q?void 0:Q.id)?o:"-"]}),(0,t.jsxs)("p",{className:"mt-2",children:[(0,t.jsx)("span",{className:"font-semibold",children:"Recibo vía:"})," ","email"===Z?R.email:eo]})]}),(0,t.jsx)("button",{className:"btn btn-outline",onClick:()=>p.push("/"),children:"Volver al inicio"})]})})]}),(0,t.jsx)("aside",{className:"space-y-4",children:(0,t.jsx)(C,{items:null!=(d=null==ea?void 0:ea.items)?d:E,baseTotal:null!=(c=null==ea?void 0:ea.baseTotal)?c:T,deliveryFee:null!=(u=null==ea?void 0:ea.deliveryFee)?u:er,orderTotal:null!=(m=null==ea?void 0:ea.orderTotal)?m:ei,deliveryInfo:"delivery"===R.fulfillmentMode?B:null})})]})]}):(0,t.jsxs)("div",{className:"container-edge py-16 text-center",children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold",children:"Checkout"}),(0,t.jsx)("p",{className:"mt-2 text-sm text-slate-600",children:"Cargando detalles del pedido…"})]}):(0,t.jsxs)("div",{className:"container-edge py-16 text-center",children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold",children:"Tu carrito está vacío"}),(0,t.jsx)("p",{className:"mt-3 text-sm text-slate-600",children:"Agrega productos para iniciar el proceso de compra."})]})}function v(e){let{currentStep:l}=e;return(0,t.jsx)("div",{className:"mt-6 grid gap-3 md:grid-cols-4",children:["Información","Entrega","Pago","Confirmación"].map((e,a)=>{let s=a+1;return(0,t.jsxs)("div",{className:"rounded-2xl border px-4 py-3 text-sm transition ".concat(l===s?"border-slate-900 bg-slate-900 text-white":l>s?"border-emerald-400 bg-emerald-50 text-emerald-700":"border-slate-200 bg-white text-slate-600"),children:[(0,t.jsxs)("div",{className:"text-xs uppercase tracking-[0.3em]",children:["Paso ",a+1]}),(0,t.jsx)("div",{className:"mt-1 font-semibold",children:e})]},e)})})}function g(e){let{title:l,children:a}=e;return(0,t.jsxs)("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:l}),(0,t.jsx)("div",{className:"mt-4 space-y-4",children:a})]})}function N(e){let{onBack:l,onNext:a,nextDisabled:s,nextLabel:n,backLabel:r}=e;return(0,t.jsxs)("div",{className:"flex flex-col gap-3 pt-4 sm:flex-row sm:justify-end",children:[l&&(0,t.jsx)("button",{onClick:l,type:"button",className:"btn btn-outline sm:w-auto",children:null!=r?r:"Anterior"}),(0,t.jsx)("button",{type:"button",className:"btn btn-primary sm:w-auto",disabled:s,onClick:a,children:n})]})}function P(e){let{label:l,description:a,selected:s,onClick:n}=e;return(0,t.jsxs)("button",{type:"button",onClick:n,className:"rounded-2xl border px-4 py-3 text-left transition ".concat(s?"border-slate-900 bg-slate-900/5":"border-slate-200 hover:border-slate-300"),children:[(0,t.jsx)("div",{className:"font-semibold text-slate-900",children:l}),(0,t.jsx)("p",{className:"mt-1 text-xs text-slate-600",children:a})]})}function k(e){let{fulfillmentMode:l,selectedPartnerId:a,deliveryInfo:s,customerLocation:n}=e,r=a?y(a):null;if(!r)return(0,t.jsx)("div",{className:"rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-600",children:"Selecciona un aliado en el paso anterior."});let i=n?(S(n.lat,n.lng,r.lat,r.lng)/1e3).toFixed(1):null;return"pickup"===l?(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-slate-900/5 p-4",children:[(0,t.jsx)("div",{className:"text-sm font-semibold text-slate-900",children:r.name}),(0,t.jsx)("p",{className:"text-xs text-slate-600",children:r.address}),(0,t.jsx)("p",{className:"text-[11px] uppercase tracking-wide text-slate-400",children:r.cityState}),i&&n&&(0,t.jsxs)("p",{className:"mt-2 text-xs text-slate-500",children:["Aproximadamente ",i," km desde tu ubicación."]})]}):s?(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-slate-900/5 p-4",children:[(0,t.jsxs)("div",{className:"text-sm font-semibold text-slate-900",children:["Aliado asignado: ",r.name]}),(0,t.jsx)("p",{className:"text-xs text-slate-600",children:r.address}),(0,t.jsx)("p",{className:"text-[11px] uppercase tracking-wide text-slate-400",children:r.cityState}),(0,t.jsxs)("div",{className:"mt-3 flex flex-wrap items-center gap-3 text-xs text-slate-700",children:[(0,t.jsxs)("span",{className:"rounded-full bg-slate-900/5 px-2 py-1 font-semibold",children:["Estimado: ",s.minutes," min"]}),(0,t.jsxs)("span",{className:"rounded-full bg-slate-900/5 px-2 py-1 font-semibold",children:["Cobrado: ",s.minutesCapped," min"]}),(0,t.jsxs)("span",{className:"rounded-full bg-slate-900/5 px-2 py-1 font-semibold",children:["Cargo adicional: $",s.fee.toFixed(2)]})]}),(0,t.jsxs)("div",{className:"mt-2 text-xs text-slate-500",children:["Fuente: ","ors"===s.source?"Ruta ORS":"Estimación"]}),i&&(0,t.jsxs)("div",{className:"mt-4 text-xs text-slate-600",children:["Distancia aproximada: ",i," km."]}),(0,t.jsx)("div",{className:"mt-4 rounded-xl border border-dashed border-slate-300 bg-white px-3 py-2 text-xs text-slate-600",children:"El costo de envío se calcula a $0.50 por minuto (máximo 45 minutos), utilizando el aliado sugerido."})]}):(0,t.jsx)("div",{className:"rounded-xl border border-slate-200 bg-slate-50 px-4 py-3 text-sm text-slate-600",children:"Calcularemos el aliado más cercano una vez ingreses tu dirección completa."})}function M(e){let{method:l}=e;return(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-200 bg-slate-900/5 p-4",children:[(0,t.jsx)("h4",{className:"text-sm font-semibold uppercase tracking-[0.2em] text-slate-500",children:"Instrucciones"}),(0,t.jsx)("ul",{className:"mt-3 space-y-1 text-sm text-slate-700",children:l.merchantInfo.map(e=>(0,t.jsxs)("li",{className:"flex items-center justify-between gap-4",children:[(0,t.jsx)("span",{className:"text-slate-500",children:e.label}),(0,t.jsx)("span",{className:"font-semibold text-slate-900",children:e.value})]},e.label))})]})}function C(e){let{items:l,baseTotal:a,deliveryFee:s,orderTotal:n,deliveryInfo:r}=e;return(0,t.jsxs)("div",{className:"rounded-3xl border border-slate-200 bg-white p-6 shadow-sm",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-slate-900",children:"Resumen del pedido"}),(0,t.jsx)("div",{className:"mt-4 space-y-3 text-sm text-slate-700",children:l.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{children:[e.name," × ",e.quantity]}),(0,t.jsxs)("span",{children:["$",e.total.toFixed(2)]})]},e.key))}),(0,t.jsxs)("div",{className:"mt-4 border-t border-slate-200 pt-4 text-sm text-slate-700",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{children:"Subtotal"}),(0,t.jsxs)("span",{children:["$",a.toFixed(2)]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between text-slate-500",children:[(0,t.jsx)("span",{children:"Envío"}),(0,t.jsx)("span",{children:r?"$".concat(s.toFixed(2)):"$0.00"})]}),(0,t.jsxs)("div",{className:"mt-3 flex items-center justify-between text-base font-semibold text-slate-900",children:[(0,t.jsx)("span",{children:"Total"}),(0,t.jsxs)("span",{children:["$",n.toFixed(2)]})]})]}),r&&(0,t.jsxs)("div",{className:"mt-4 rounded-xl border border-slate-200 bg-slate-900/5 px-3 py-2 text-xs text-slate-600",children:["Envío calculado ","ors"===r.source?"con ORS":"con estimación",". Distancia aproximada: ",r.distanceMeters?"".concat((r.distanceMeters/1e3).toFixed(1)," km"):"N/D","."]})]})}function S(e,t,l,a){let s=e=>e*Math.PI/180,n=s(e),r=s(l),i=Math.sin(s(l-e)/2)**2+Math.cos(n)*Math.cos(r)*Math.sin(s(a-t)/2)**2;return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371e3}}]);